\documentclass{amsart}

\usepackage[utf8x]{inputenc}
\usepackage{graphicx}
\usepackage{caption}
%\usepackage{epstopdf}
\usepackage{enumerate}
\usepackage{amsmath,amsfonts,amsthm,amssymb}
\usepackage{mathrsfs}
\usepackage{url}
\usepackage{acronym}
\usepackage{thmtools}
\usepackage{nicefrac}
\usepackage{pseudocode}
% \usepackage[authoryear]{natbib}
\usepackage{wrapfig}

% Clever references
% \usepackage{cleveref}
% 
% \crefname{equation}{}{}
% \Crefname{equation}{}{}
% \crefname{figure}{figure}{figures}
% \Crefname{figure}{Figure}{Figures}
% \crefname{appendix}{Appendix}{Appendices}
% \Crefname{appendix}{Appendix}{Appendices}
% \crefname{section}{Section}{Sections}
% \Crefname{section}{Section}{Sections}

% Own stuff
\usepackage{../mathdefs}
\usepackage{../notecommand}
\usepackage{../mytheorems}
\usepackage{../other}

\usepackage[pdftex,unicode,colorlinks=true,linkcolor=black,citecolor=black,hypertexnames=true]{hyperref}
\hypersetup{pdfauthor={},pdftitle={Common representation of acquisition geometries in tomography}}

% Figure are placed in figures directory.
\graphicspath{{Pictures/}}

% Acronyms (depends on the acronym package)
\acrodef{em}[EM]{electron microscopy}
\acrodef{EM}[EM]{Electron Microscopy}
\acrodef{et}[ET]{electron tomography}
\acrodef{ET}[ET]{Electron Tomography}
\acrodef{stem}[STEM]{scanning transmission electron microscopy}
\acrodef{psf}[PSF]{point spread function}
\acrodef{PSF}[PSF]{Point Spread Function}
\acrodef{ctf}[CTF]{contrast transfer function}
\acrodef{CTF}[CTF]{Contrast Transfer Function}
\acrodef{nufFt}[FT]{non-uniform fast Fourier transform}
\acrodef{NufFt}[FT]{Non-uniform fast Fourier transform}
\acrodef{NUFFT}[FT]{Non-Uniform Fast Fourier Transform}
\acrodef{Ft}[FT]{Fourier transform}
\acrodef{FT}[FT]{Fourier Transform}
\acrodef{snr}[SNR]{signal-to-noise ratio}
\acrodef{SNR}[SNR]{Signal-to-Noise Ratio}


\title{Common representation of acquisition geometries in tomography}
\author{}
\date{\today}

% \usepackage{other}

\newcommand*{\Dinv}{{\ensuremath{D^{-1}}}}
\renewcommand*{\phi}{\varphi}

% \setlength{\parindent}{0pt}

\begin{document}

\maketitle




\section{General theory}
%
%
%
During data acquisition, detector and sample move relative to each other. Thus, the position of a specific point on the detector varies 
with time or some other parameter, like a rotation angle. Furthermore, we consider detectors which are surface-, curve- or point-like and 
can be regarded as manifolds in $\RR^D$ parameterized over an open set in $\RR^d$ with typically $d < D$. Hence, we use the following 
representation:\\
Let $T \subset \RR^p$ be a set of (time, angle, \ldots) parameters and $U \subset \RR^d$ a set of detector parameters, e.g. $x$ and $y$ 
coordinates on a flat 2D detector. We call a mapping
%
\begin{equation}
 X: T \times U \longrightarrow \RR^D
\end{equation}
%
the \emph{detector trace parametrization} and $X(T \times U) \subset \RR^D$ the \emph{detector trace}. For fixed $t \in T$, we define the 
\emph{detector parametrization}
%
\begin{equation}
 X_t = X(t, \cdot) : U \Lto \RR^D
\end{equation} 
%
and call $X_t(U) \subset \RR^D$ the detector surface (at time $t$).\\[1ex]
%
%
To model the very general situation of directional input (like rays) to the detector, we further define the \emph{directional field}
%
\begin{equation}
 N: T \times U \Lto \SPHERE^{D-1}.
\end{equation}
%
For $t \in T$ and $u \in U$, the value $N(t, u) \in \SPHERE^{D-1}$ stands for the orientation of the detector at the point $X(t,u)$ caused 
by e.g. collimators. Often, $N(t, u)$ is the unit normal to the detector surface at $X(t, u)$. \\[1ex]
%
%
In the case that one detector point ``sees'' more than one incoming direction, we additionally define the 
\emph{detector pupil}
%
\begin{equation}
 P: T \times U \Lto \mathrm{P}(\SPHERE^{D-1})
\end{equation} 
%
which maps $t, u$ to the subset $P(t, u) \subset \SPHERE^{D-1}$ of directions seen by the detector point at $X(t, u)$. This covers, for 
example, the case of PET where the detector pixels register not only perpendicular photons but also photons coming in at an angle.\\[1ex]
%
%
Finally, if the incoming ``radiation'' is not travelling along straight lines, we need to provide this information, too. However, we will 
restrict ourselves to the case where we can uniquely trace such a ray back from a detector point through the sample. We thus define a 
mapping
%
\begin{equation}
 \gamma: T \times U \times \SPHERE^{D-1} \Lto C_{\mathrm{pw}}^1\big([0,\infty), \RR^d\big)
\end{equation} 
%
where for $t \in T$, $u \in u$ and $\theta \in \SPHERE^{D-1}$, the function $\gamma(t, u, \theta)$ represents the ray arriving at the 
detector point $X(t, u)$ from the direction $\theta$. The subscript ``pw'' stands for ``piecewise'' with the restriction that the lengths 
of such pieces must be bounded from below by a positive constant.  If $P(t,u) = \lbrace N(t,u)\rbrace$, we write 
%
\begin{equation}
 \tilde \gamma: T \times U \Lto C_{\mathrm{pw}}^1\big([0,\infty), \RR^d\big),\quad \tilde \gamma(t,u) = \gamma\big(t, u, N(t,u)\big).
\end{equation}
%
%
Let now $\Omega \subset \RR^D$ be a suitable set and $\big(\SPCH_j, \INNER{\cdot}{\cdot}_j\big)$, $j=1,2$ be Hilbert spaces. In this 
setting, we can study forward operators of the form
%
\begin{align}
 & \OPA: \SPCH_1(\Omega) \Lto \SPCH_2(T \times U) \\
 & \OPA f(t, u) = \int_{P(t, u)} \int_{\gamma(t, u, \theta) \cap \Omega} f \, \D \gamma\, \D \theta.
\end{align}
%
which maps a pair of parameters $(t, u)$ to the integral of $f$ along all rays arriving at $X(t, u)$. For $L^2$ spaces, we want to 
calculate the adjoint operator:
%
\begin{align}
 \INNER{\OPA f}{g}_2 
 &= \int_T \int_U \OPA f(t, u)\, g(t, u)\, \D u\, \D t \notag \\
 &= \int_T \int_U \int_{P(t, u)} \int_{\gamma(t, u, \theta) \cap \Omega} f \, \D \gamma\, \D \theta\, g(t, u)\, \D u\, \D t \notag \\
 \label{eq:adj_calculation_step1}
 &= \int_T \int_U \int_{P(t, u)} \int_0^\infty  [f \circ \gamma(t, u, \theta)](s)\, \ABS{\gamma(t, u, \theta)'(s)}\, g(t, u)\, \D s\, 
 \D \theta\, \D u\, \D t.
\end{align}
%
We first consider the case where $P(t,u) = \lbrace N(t,u)\rbrace$, i.e. there is exactly one ray arriving at each detector point 
$X_t(u)$ with incoming direction $N_t(u)$. For fixed $t \in T$, we assume that for each $x \in \Omega$, there is a unique ray 
$\tilde \gamma_t(u) = \tilde \gamma_t(u; x)$ containing the point $x$ exactly once, i.e. $\tilde \gamma_t(u; x)(s(x)) = x$. Thus, we can 
define a 
mapping
%
\begin{equation*}
 \Gamma_t: \Omega \to [0, \infty) \times U,\quad x \mapsto (s, u) \text{ with } \tilde \gamma_t(u)(s) = x,
\end{equation*}
%
which is the inverse of the mapping $(s,u) \mapsto \tilde \gamma_t(u)(s)$. The point $X_t\big(u(x)\big)$ can be interpreted as the 
projection of 
$x$ to the detector surface along the corresponding ray, and $s(x)$ is the arc length along the ray from $x$ to its projection. 
Now we can rewrite the integral \eqref{eq:adj_calculation_step1} as
%
\begin{align*}
 \INNER{\OPA f}{g}_2
 &= \int_T \int_{\Gamma_t(\Omega)} f\big(\Gamma_t^{-1}(s,u)\big) \ABSLR{\partial_s \Gamma_t^{-1}(s,u)}\, g(t, u)\, \D s\, \D u\, 
 \D t  \\
 &= \int_T \int_{\Gamma_t(\Omega)} f\big(\Gamma_t^{-1}(s,u)\big) \ABSLR{\big[\partial \Gamma_t\big(\Gamma_t^{-1}(s,u)\big)\big]_1}^{-1}\, 
 g(t, u)\, \D  s\, \D u\, \D t \\
 &= \int_T \int_\Omega f(x) \ABSLR{\big[\partial \Gamma_t(x)\big]_1}^{-1}\, \ABS{\DET{\partial \Gamma_t(x)}}\, 
 g\big(t, \Pi_{\gamma_t}(x)\big)
 \, \D x\, \D t,
\end{align*}
%
where $[\partial \Gamma_t]_1$ stands for the first column of the Jacobian of $\Gamma_t$ and $\Pi_{\gamma_t}(x) = [\Gamma_t(x)]_2$ is the 
$u$ component of $(s, u) = \Gamma_t(x)$. Note that $\ABS{[\partial \Gamma_t]_1} = 1$ if the rays are parametrized with respect to arc 
length. Hence, the adjoint operator can be written as
%
\begin{equation}
 \label{eq:adj_op_onedir}
 \DUALOPA g(x) = \int_T \ABSLR{\big[\partial \Gamma_t(x)\big]_1}^{-1}\, \ABS{\DET{\partial \Gamma_t(x)}}\, g\big(t, 
\Pi_{\gamma_t}(x)\big)\, 
 \D t
\end{equation}
%
which is equal to
%
\begin{equation}
 \label{eq:adj_op_onedir_alt}
 \DUALOPA g(x) = \int_T \ABSLR{\partial_s \Gamma_t^{-1}\big(\Gamma_t(x)\big)}\, 
 \ABS{\DET{\partial \Gamma_t^{-1}\big(\Gamma_t(x)\big)}}^{-1}\, g\big(t, \Pi_{\gamma_t}(x)\big)\, \D t.
\end{equation}
%
If the transformation factors cannot be determined, it is still possible to calculate the adjoint
%
\begin{align}
 \OPA^\#: \SPCH_2(T \times U, w) \Lto \SPCH_1(\Omega) \notag \\
 \label{eq:adj_op_onedir_weighted}
 \OPA^\# g(x) = \int_T g\big(t, \Pi_{\gamma_t}(x)\big)\, \D t
\end{align}
%
on the weighted image space $\SPCH_2$ with unknown weight $w: T \times U \to [0, \infty)$. 





\section{Examples}



\begin{example}[Parallel geometry]
 We consider a flat 2D detector moving on the unit circle in the $x$-$y$ plane, oriented to the center of the circle:
 %
 \begin{align*}
  & T = [-\phi_0, \phi_0],\quad U = [-l_x/2, l_x/2] \times [-l_z/2, l_z/2] \\
  & X(\phi, u) = \theta(\phi) + R(\phi) \cdot \TRANSP{(u_1, 0, u_2)}
 \end{align*}
 %
 with $\phi_0 \in (0, \pi/2]$, $l_x, l_z > 0$ and
 %
 \begin{align}
  \theta(\phi) &= \TRANSP{(-\sin\phi, \cos\phi, 0)}, \\ 
  R(\phi) &=
  \begin{pmatrix}
   \cos\phi & -\sin\phi & 0 \\
   \sin\phi & \cos\phi & 0 \\
   0 & 0 & 1
  \end{pmatrix}
  = \big(\theta'(\phi) | \theta(\phi) | e_z\big).
 \end{align}
 %
 The classical X-ray transform in these coordinates for functions on a set $\Omega \subset B_1$ in $\RR^3$ is given by
 %
 \begin{align}
  &\OPP: L^2(\Omega) \Lto L^2(T \times U), \notag \\
  \label{eq:parallel_fwdproj}
  &\OPP f(\phi, u) = \int_\RR f\big(s\theta(\phi) + u_1 \theta'(\phi) + u_2 e_z\big)\, \D s,
 \end{align}
 %
 and its adjoint is the backprojection
 %
 \begin{equation}
  \label{eq:parallel_backproj}
  \DUALOPP g(x) = \int_{-\phi_0}^{\phi_0} g\big(\phi, \INNER{x}{\theta'(\phi)}, \INNER{x}{e_z}\big)\, \D \phi.
 \end{equation}
 %
 In our common framework, the directional mapping is given by $N(\phi, u) = -\theta(\phi)$, which is also the canonical normal 
 $n = \eta_1 \times \eta_2$ with $\eta_j = \partial_{u_j} X / \ABS{\partial_{u_j} X}$. It is $P(\phi, u) = \lbrace N(\phi, u)\rbrace$.
 The rays are straight lines, and their formula is (leaving out the ``$\,\widetilde{\ }\,$'' to simplify notation)
 %
 \begin{equation*}
  \gamma_\phi(u) = \big( s \mapsto X(\phi, u) + (1-s) N(\phi, u),\ s > 0 \big).
 \end{equation*}
 %
 They start at the far end of the object support $\Omega$ and continue to the detector, hence the integration domain of the $s$ 
 integral can be extended to $\RR$. Thus, we get the transform
 %
 \begin{align*}
  \OPP: L^2(B_1) & \Lto L^2(T \times U) \\
  \OPP f(\phi, u) 
  &= \int_{\gamma_\phi(u)} f\, \D \gamma \\
  &= \int_0^\infty f\big(X(\phi, u) + (1-s) N(\phi, u)\big)\, \D s \\
  &= \int_\RR f\big(s \theta(\phi) + R(\phi) \cdot \TRANSP{(u_1, 0, u_2)}\big)\, \D s,
 \end{align*}
 %
 which is \eqref{eq:parallel_fwdproj}. To compare the adjoint obtained by the generic formula \eqref{eq:adj_op_onedir} with 
 \eqref{eq:parallel_backproj}, we observe that we can write $x \in \Omega$ as
 %
 \begin{align*}
  x 
  &= \INNER{x}{\theta(\phi)}\, \theta(\phi) + \big(x - \INNER{x}{\theta(\phi)}\, \theta(\phi)\big) \\
  &= \INNER{x}{\theta(\phi)}\, \theta(\phi) + \INNER{x}{\theta'(\phi)}\, \theta'(\phi) + \INNER{x}{e_z}\, e_z \\
  &= \INNER{x}{\theta(\phi)}\, \theta(\phi) + R(\phi) \TRANSP{\big(\INNER{x}{\theta'(\phi)}, 0, \INNER{x}{e_z}\big)}.
 \end{align*}
 %
 This means that for $s = 1 - \INNER{x}{\theta(\phi)}$ and $u = \TRANSP{\big(\INNER{x}{\theta'(\phi)}, \INNER{x}{e_z}\big)}$, it is 
 $x = \gamma\big(\phi, u, N(\phi, u)\big)(s)$, and thus the mapping $\Gamma_\phi$ can be explicitly determined as
 %
 \begin{equation*}
  \Gamma_\phi(x) = \TRANSP{\big(1 - \INNER{x}{\theta(\phi)}, \INNER{x}{\theta'(\phi)}, \INNER{x}{e_z}\big)}
 \end{equation*}
 %
 The Jacobian of this coordinate transform is apparently a column permutation of $R(\phi)$, hence the additional factors in the integral 
 \eqref{eq:adj_op_onedir} are one, and we can conclude that
 %
 \begin{equation*}
  \DUALOPP g(x) = \int_{-\phi_0}^{\phi_0} g\big(\phi, \INNER{x}{\theta'(\phi)}, \INNER{x}{e_z}\big)\, \D\phi,
 \end{equation*}
 %
 which is the same as \eqref{eq:parallel_backproj}.
\end{example}




\begin{example}[Fan beam geometry]
 Here, we consider the case of 2D functions on $\Omega = B_1 \subset \RR^2$. The detector is a segment of a circle with radius $R > 1$ and 
 detects rays coming from a point source on the opposite side of a smaller circle with radius $r$. We write $R = \beta r$, $\beta \geq 1$ 
 and parametrize the detector as follows:
 %
 \begin{align*}
  & T = [0, \phi_0],\quad U = [-\psi_0, \psi_0] \\
  & X(\phi, \psi) = -(R - r) \theta(\phi) + R \theta(\phi + \psi) = -(\beta - 1) r \theta(\phi) + \beta r \theta(\phi + \psi),
 \end{align*}
 %
 with $\theta(\phi) = (\cos\phi, \sin\phi)$ and parameters $\phi_0 \in (0, 2\pi]$ and $\psi_0 \in (0, \pi/2]$. The mathematical model 
 for X-ray tomography in this setting is the divergent beam transform
 %
 \begin{align}
  &\OPD: L^2(\Omega) \Lto L^2(T \times U) \notag\\
  \label{eq:fanbeam_fwdproj_otherangle}
  &\OPD f(\phi, \psi) = \int_0^\infty f\big(x_{\mathrm{S}}(\phi) + s \theta(\phi + \tilde\psi)\big)\, \D s
 \end{align}
 %
 with the source position $x_{\mathrm{S}} = -r \theta(\phi)$ and the directional vectors $\theta(\phi) = (\cos\phi, \sin\phi)$. Here, 
 $\tilde\psi$ is the angle between $\theta(\phi)$ and the line from the source to the detector point $X(\phi, \psi)$. By means of simple 
 geometry, one can show that $2r \tilde\psi = R\psi$, i.e. we have
 %
 \begin{equation}
  \label{eq:fanbeam_fwdproj_realangle}
  \OPD f(\phi, \psi) = \int_0^\infty f\big(x_{\mathrm{S}}(\phi) + s \theta(\phi + \beta\psi/2)\big)\, \D s.
 \end{equation} 
 %
 Now we derive its relation to the 2D parallel beam X-ray transform
 %
 \begin{align}
  &\OPP: L^2(B_1) \Lto L^2([0,2\pi) \times [-r,r]) \notag \\
  \label{eq:fanbeam_xray_fwdproj}
  &\OPP f(\phi, \tau) = \int_\RR f\big(s\theta(\phi) + \tau \theta'(\phi)\big)\, \D s,
 \end{align} 
 %
 with $\theta'(\phi) = \TRANSP{(-\sin\phi, \cos\phi)}$. Its adjoint is
 %
 \begin{equation}
  \label{eq:fanbeam_xray_backproj}
  \DUALOPP g(x) = \int_0^{2\pi} g\big(\phi, \INNER{x}{\theta'(\phi)}\big)\, \D\phi.
 \end{equation} 
 %
 We have
 %
 \begin{align*}
  \OPD f(\phi, \psi) 
  &= \int_\RR f\big(- r\theta(\phi) + s \theta(\phi + \beta\psi/2)\big)\, \D s \\
  &= \int_\RR f\big(s \theta(\phi + \beta\psi/2) - r \Pi_{\theta(\phi + \beta\psi/2)}\theta(\phi) \big)\, \D s,
 \end{align*}
 %
 and the projection $\Pi_{\theta(\phi + \beta\psi/2)}\theta(\phi)$ can be calculated as
 %
 \begin{align*}
  \Pi_{\theta(\phi + \beta\psi/2)}\theta(\phi)
  &= \theta(\phi) - \INNERLR{\theta(\phi)}{\theta(\phi + \beta\psi/2)}\, \theta(\phi + \beta\psi/2) \\
  &=
  \begin{pmatrix}
   \cos\phi - \cos(\psi/2)\, \cos(\phi + \beta\psi/2) \\
   \sin\phi - \cos(\psi/2)\, \sin(\phi + \beta\psi/2)
  \end{pmatrix} \\
  &=
  \begin{pmatrix}
   \sin(\phi + \beta\psi/2)\, \sin(\beta\psi/2) \\
   -\cos(\phi + \beta\psi/2)\, \sin(\beta\psi/2)
  \end{pmatrix} \\
  &= -\sin(\beta\psi/2)\, \theta'(\phi + \beta\psi/2)
 \end{align*}
 %
 and thus 
 %
 \begin{align*}
  \OPD f(\phi, \psi)
  &= \int_\RR f\big(s \theta(\phi + \beta\psi/2) + r \sin(\beta\psi/2)\, \theta'(\phi + \beta\psi/2) \big)\, \D s \\
  &= \OPP f\big(\phi + \beta\psi/2, r\sin(\beta\psi/2)\big) \\
  &= \OPU \OPP f(\phi, \psi)
 \end{align*}
 %
 with the transform
 %
 \begin{align}
  &\OPU: L^2\big([0,2\pi) \times [-r,r]\big) \Lto L^2\big([0,\phi_0] \times [-\psi_0,\psi_0]\big) \notag \\
  \label{eq:fanbeam_unit_trafo}
  &\OPU g(\phi, \psi) = g\big(\phi + \beta\psi/2, r\sin(\beta\psi/2)\big).
 \end{align} 
 %
 To compute its adjoint, we apply the substitution $\tau = r\sin(\beta\psi/2),\ \D\tau = \sqrt{r^2-\tau^2}\, \beta/2\, \D \psi$ and get
 %
 \begin{align*}
  \INNER{\OPU g}{h} 
  &= \int_0^{\phi_0} \int_{-\psi_0}^{\psi_0} g\big(\phi + \beta\psi/2, r\sin(\beta\psi/2)\big)\, h(\phi, \psi)\, \D\psi\, \D\phi \\
  &= \int_0^{2\pi} \int_{-\psi_0}^{\psi_0} g\big(\phi + \beta\psi/2, r\sin(\beta\psi/2)\big)\, h_0(\phi, \psi)\, \D\psi\, \D\phi \\
  &= \int_0^{2\pi} \int_{-\psi_0}^{\psi_0} g\big(\phi, r\sin(\beta\psi/2)\big)\, h_0(\phi - \beta\psi/2, \psi)\, \D\phi\, \D\psi \\
  &= \int_0^{2\pi} \int_{-r\sin(\beta\psi_0/2)}^{r\sin(\beta\psi_0/2)} g(\phi, \tau)\, h_0\big(\phi - \arcsin(\tau/r), 
  2\arcsin(\tau/r)/\beta\big)\, \frac{2}{\beta\sqrt{r^2-\tau^2}} \D\phi\, \D\tau,
 \end{align*}
 %
 where
 %
 \begin{equation*}
  h_0(\phi, \cdot) =
  \begin{cases}
   h(\phi, \cdot) & \text{ if } \phi \in [0,\phi_0] \\
   0 & \text{ else}.
  \end{cases}
 \end{equation*}
 %
 The integration domain $[-r\sin(\beta\psi_0/2), r\sin(\beta\psi_0/2)]$ covers the support of $g = \OPP f$ if the condition
 %
 \begin{equation}
  \label{eq:fanbeam_condition_roi}
  r \sin(\beta\psi_0/2) \geq 1
 \end{equation}
 %
 is fulfilled. In this case, all points in $\Omega$ are covered by rays from each direction, and it is
 %
 \begin{equation}
  \label{eq:fanbeam_unit_trafo_adj_good}
  \DUALOPU h(\phi, \tau) = \frac{2}{\sqrt{r^2-\tau^2}} \, h_0\big(\phi - \arcsin(\tau/r), 2\arcsin(\tau/r)/\beta\big).
 \end{equation}
 %
 Otherwise, the adjoint involves a cutoff,
 %
 \begin{equation}
  \label{eq:fanbeam_unit_trafo_adj_bad}
  \DUALOPU h(\phi, \tau) = \frac{2}{\sqrt{r^2-\tau^2}} \, h_0\big(\phi - \arcsin(\tau/r), 2\arcsin(\tau/r)/\beta\big)\, 
  \chi_{[0, r\sin(\beta\psi_0/2)]}(\ABS{\tau}).
 \end{equation}
 %
 Thus, if \eqref{eq:fanbeam_condition_roi} is fulfilled, it is $\DUALOPD = \DUALOPP\DUALOPU$, i.e.
 %
 \begin{align}
  \DUALOPD g(x)
  &= \int_0^{2\pi} \DUALOPU g\big(\phi, \INNER{x}{\theta'(\phi)}\big)\, \D\phi \notag\\
  \label{eq:fanbeam_backproj}
  &= \int_0^{2\pi} \frac{2}{\beta\sqrt{r^2-\tau(\phi, x)^2}} g_0\left(\phi - \psi(\phi,x)/2, \psi(\phi,x) \right)\, \D\phi,
 \end{align}
 %
 where $\tau(\phi,x) = \INNER{x}{\theta'(\phi)}$ and $\psi(\phi,x) = 2\arcsin\big(\tau(\phi,x)/r\big) / \beta$.\\[1ex]
 %
 We now apply the unified theory to compare the results. For the directional field $N$, we already showed that 
 $N(\phi,\psi) = -\theta(\phi + \beta\psi/2)$, see \eqref{eq:fanbeam_fwdproj_realangle}. As in the parallel geometry, we have 
 $P(\phi,\psi) = \lbrace N(\phi,\psi)\rbrace$, and the rays are lines from the far end of the object to the detector. In order to determine 
 the adjoint using \eqref{eq:adj_op_onedir}, we need to find $\Gamma_\phi$ as the inverse of 
 $(\psi, s) \mapsto \tilde X(\phi, \psi) + (2r - s) N(\phi,\psi)$. However, since $s$ is only a help variable which does not appear in the 
 final formula, we can select any parametrization of a ray through $x$ by arc length. An obvious choice is
 %
 \begin{equation*}
  \gamma_x(s) = -r \theta(\phi) + s\, \frac{x + r\theta}{\ABS{x + r\theta}}
 \end{equation*}
 %
 from the source point ($s=0$) through $x$ with parameter $s_x=\ABS{x + r\theta}$. If we denote by $\tilde\psi_x$ the angle between this 
ray and  $\theta(\phi)$, we can immediately conclude that
 %
 \begin{equation*}
  \cos \tilde\psi_x = \frac{\INNER{x + r\theta(\phi)}{\theta(\phi)}}{\ABS{x + r\theta(\phi)}} 
  = \frac{r + \INNER{x}{\theta(\phi)}}{\sqrt{\ABS{x}^2 + r^2 + 2r \INNER{x}{\theta(\phi)}}}.
 \end{equation*}
 %
 The same argument as in the derivation of \eqref{eq:fanbeam_fwdproj_realangle} yields the corresponding detector angle
 %
 \begin{equation}
  \label{eq:fanbeam_psi_x}
  \psi_x = \frac{2}{\beta}\, \arccos\left( \frac{r + \INNER{x}{\theta(\phi)}}{\sqrt{\ABS{x}^2 + r^2 + 2r \INNER{x}{\theta(\phi)}}} \right).
 \end{equation}
 %
 Now it remains to calculate the functional determinant of the change of coordinates $(\psi, s) \to x$. In an intermediate step, we set 
 $\mu_x = \cos \tilde\psi_x$ and get the functional determinant
 %
 \begin{equation*}
  \DET \frac{\partial(\mu_x, s_x)}{\partial x} = - \frac{\INNER{x}{\theta'(\phi)}}{\ABS{x + r \theta(\phi)}^3}.
 \end{equation*}
 %
 Furthermore, it is
 %
 \begin{equation*}
  \frac{\D \tilde\psi_x}{\D \mu_x}\big(\mu_x\big) = \arccos'(\mu_x) = - \frac{1}{\sqrt{1 - \mu_x^2}}.
 \end{equation*}
 %
 This expression can be simplified as follows:
 %
 \begin{align*}
  1 - \mu_x^2 
  &= \frac{\ABS{x + r\theta(\phi)}^2 - \big(\INNER{x}{\theta(\phi)} + r\big)^2}{\ABS{x + r\theta(\phi)}^2} \\
  &= \frac{\ABS{x}^2 + 2r \INNER{x}{\theta(\phi)} + r^2 - \INNER{x}{\theta(\phi)}^2 - 2r\INNER{x}{\theta(\phi)} - r^2}{\ABS{x + 
  r\theta(\phi)}^2} \\
  &= \frac{\ABS{x}^2 - \INNER{x}{\theta(\phi)}^2}{\ABS{x + r\theta(\phi)}^2} \\
  &= \frac{\INNER{x}{\theta'(\phi)}^2}{\ABS{x + r\theta(\phi)}^2}.
 \end{align*}
 %
 Hence, with the chain rule, we get
 %
 \begin{equation*}
  \ABSLR{\DET \frac{\partial(\tilde\psi_x, s_x)}{\partial x} (x)} = \ABSLR{\DET \frac{\partial(\mu_x, s_x)}{\partial x} (x)} \cdot
  \ABSLR{\frac{\D \tilde\psi_x}{\D \mu_x}\big(\mu_x\big)} = \frac{1}{\ABS{x + r\theta(\phi)}^2}.
 \end{equation*}
 %
 The transition from $\tilde\psi_x$ to $\psi_x$ introduces a factor $2/\beta$, and the adjoint can be finally written as
 %
 \begin{equation}
  \label{eq:fanbeam_backproj_alt}
  \OPD^* g(x) = \int_0^{\phi_0} \frac{2}{\beta \ABS{x + r\theta(\phi)}^2}\, g\big(\phi, \psi(\phi, x)\big)\, \D \phi
 \end{equation}
 %
 with $\psi(\phi, x) = \psi_x$ as defined in \eqref{eq:fanbeam_psi_x}. It is not obvious that this formula is equivalent to 
 \eqref{eq:fanbeam_backproj}.
\end{example}

\end{document}
